commonConfig:
  databaseUrl: "postgresql://$(DATABASE_ENDPOINT)/kmsconnector"
  gatewayUrl: "$(CONDUIT_RPC_HTTP_URL)"
  # Cannot be used for tx-sender until full node supports eth_sendRawTransactionSync
  #gatewayUrl: "http://gateway-node:8547"
  chainId: "10901"
  gatewayContractAddresses:
    decryption: "0x5D8BD78e2ea6bbE41f26dFe9fdaEAa349e077478"
    gatewayConfig: "0x94153006067B89399e059284f5a7Fe016940E332"
    kmsGeneration: "0x5779Ac320BbDB267Cc4d1b77195a203F926bBC60"
  env:
    - name: DATABASE_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: connector-database
          key: endpoint
    - name: PGUSER
      valueFrom:
        secretKeyRef:
          name: connector-database
          key: username
    - name: PGPASSWORD
      valueFrom:
        secretKeyRef:
          name: connector-database
          key: password
    - name: CONDUIT_RPC_HTTP_URL
      valueFrom:
        secretKeyRef:
          name: conduit
          key: conduit-rpc-http-url

kmsConnectorDbMigration:
  enabled: true
  image:
    name: hub.zama.org/zama-protocol/zama-ai/fhevm/kms-connector/db-migration
    tag: v0.10.0
  env: []
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: "node.kubernetes.io/enclave-enabled"
                operator: In
                values:
                  - "true"
  tolerations:
    - key: "node.kubernetes.io/enclave-enabled"
      effect: NoSchedule
      operator: Equal
      value: "true"

kmsConnectorGwListener:
  enabled: true
  nameOverride: kms-connector-gw-listener
  image:
    name: hub.zama.org/zama-protocol/zama-ai/fhevm/kms-connector/gw-listener
    tag: v0.10.0
  replicas: 2
  config:
    # Use full node
    gatewayUrl: "http://gateway-node:8547"
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: "node.kubernetes.io/enclave-enabled"
                operator: In
                values:
                  - "true"
  tolerations:
    - key: "node.kubernetes.io/enclave-enabled"
      effect: NoSchedule
      operator: Equal
      value: "true"

kmsConnectorKmsWorker:
  enabled: true
  nameOverride: kms-connector-kms-worker
  image:
    name: hub.zama.org/zama-protocol/zama-ai/fhevm/kms-connector/kms-worker
    tag: v0.10.0
  replicas: 1
  config:
    kmsCoreEndpoints: "http://kms-core:50100"
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: "node.kubernetes.io/enclave-enabled"
                operator: In
                values:
                  - "true"
  tolerations:
    - key: "node.kubernetes.io/enclave-enabled"
      effect: NoSchedule
      operator: Equal
      value: "true"

kmsConnectorTxSender:
  enabled: true
  nameOverride: kms-connector-tx-sender
  image:
    name: hub.zama.ai/zama-protocol/zama-ai/fhevm/kms-connector/tx-sender
    tag: v0.9.3
  replicas: 1
  wallet:
    awsKms:
      enabled: true
      configmap:
        name: mpc-party
        key: KMS_CONNECTOR__TX_SENDER_AWS_KMS_KEY_ID
    # The secret can be removed after migrating to AWS KMS
    #secret:
    #  name: connector-wallet-keys
    #  key: kms_txsender_1.private_key
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: "node.kubernetes.io/enclave-enabled"
                operator: In
                values:
                  - "true"
  tolerations:
    - key: "node.kubernetes.io/enclave-enabled"
      effect: NoSchedule
      operator: Equal
      value: "true"
